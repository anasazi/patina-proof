open import Common
open import Util.Bool

module Type where

data Mut : Set where
  imm : Mut
  mut : Mut

data Vari : Set where
  cov : Vari
  con : Vari
  inv : Vari

-- ğ”¹â„‚â„™â„šâ„â„¤  

data Life (â„™ : â„•) (â„š : â„•) : Set where
  var : Fin â„š â†’ Life â„™ â„š
  static : Life â„™ â„š
  val : Fin â„™ â†’ Life â„™ â„š

var-inj : âˆ€ {â„™ â„š a b} â†’ var {â„™} {â„š} a â‰¡ var b â†’ a â‰¡ b
var-inj refl = refl
val-inj : âˆ€ {â„™ â„š a b} â†’ val {â„™} {â„š} a â‰¡ val b â†’ a â‰¡ b
val-inj refl = refl

==L : âˆ€ {â„™ â„š} (a b : Life â„™ â„š) â†’ Dec (a â‰¡ b)
==L (var a) (var b) with a == b
==L (var a) (var .a) | yes refl = yes refl
==L (var a) (var b) | no neq = no (neq âˆ˜ var-inj)
==L (var a) static = no (Î» ())
==L (var a) (val b) = no (Î» ())
==L static (var b) = no (Î» ())
==L static static = yes refl
==L static (val b) = no (Î» ())
==L (val a) (var b) = no (Î» ())
==L (val a) static = no (Î» ())
==L (val a) (val b) with a == b
==L (val a) (val .a) | yes refl = yes refl
==L (val a) (val b) | no neq = no (neq âˆ˜ val-inj)

EqLife : âˆ€ {â„™ â„š} â†’ Eq (Life â„™ â„š)
EqLife = record { _==_ = ==L }

record TVar : Set where
  constructor `
  field
    key : â„•

`-inj : âˆ€ {a b} â†’ ` a â‰¡ ` b â†’ a â‰¡ b
`-inj refl = refl

==TV : (a b : TVar) â†’ Dec (a â‰¡ b)
==TV (` a) (` b) with a == b
==TV (` a) (` .a) | yes refl = yes refl
==TV (` a) (` b) | no neq = no (neq âˆ˜ `-inj)

EqTVar : Eq TVar
EqTVar = record { _==_ = ==TV }

data Type : (â„™ â„š : â„•) â†’ Set where
  int : âˆ€ {â„™ â„š} â†’ Type â„™ â„š
  ~ : âˆ€ {â„™ â„š} â†’ Type â„™ â„š â†’ Type â„™ â„š
  & : âˆ€ {â„™ â„š} â†’ Life â„™ â„š â†’ Mut â†’ Type â„™ â„š â†’ Type â„™ â„š
  opt : âˆ€ {â„™ â„š} â†’ Type â„™ â„š â†’ Type â„™ â„š
  struct : âˆ€ {â„™ â„š} â†’ (n : â„•) â†’ Vec (Type â„™ â„š) n â†’ Type â„™ â„š
  tvar : âˆ€ {â„™ â„š} â†’ TVar â†’ Type â„™ â„š
  Î¼ : âˆ€ {â„™ â„š} â†’ TVar â†’ Type â„™ â„š â†’ Type â„™ â„š
  -- forget existing lifetimes
  âˆ…â„“ : âˆ€ {â„™ â„š} â†’ Type 0 0 â†’ Type â„™ â„š
  Î»â„“ : âˆ€ {â„™ â„š} â†’ Type â„™ (S â„š) â†’ Type â„™ â„š
  _$â„“_ : âˆ€ {â„™ â„š} â†’ Type â„™ (S â„š) â†’ Life â„™ â„š â†’ Type â„™ â„š

shift-â„“val : âˆ€ {â„™ â„š} (amt cutoff : â„•) â†’ Type â„™ â„š â†’ Type (plus â„™ amt) â„š
shift-â„“val d c int = int
shift-â„“val d c (~ Ï„) = ~ (shift-â„“val d c Ï„)
shift-â„“val d c (& (var â„“) m Ï„) = & (var â„“) m (shift-â„“val d c Ï„)
shift-â„“val d c (& static m Ï„) = & static m (shift-â„“val d c Ï„)
shift-â„“val d c (& (val â„“) m Ï„) with lessNat (asâ„• â„“) c
shift-â„“val d c (& (val â„“) m Ï„) | true = & (val (expand â„“ d)) m (shift-â„“val d c Ï„)
shift-â„“val d c (& (val â„“) m Ï„) | false = & (val (raiseâ€² â„“ d)) m (shift-â„“val d c Ï„)
shift-â„“val d c (opt Ï„) = opt (opt (shift-â„“val d c Ï„))
shift-â„“val d c (struct n Ï„s) = {!!}
shift-â„“val d c (tvar X) = tvar X
shift-â„“val d c (Î¼ X Ï„) = Î¼ X (shift-â„“val d c Ï„)
shift-â„“val d c (âˆ…â„“ Ï„) = {!!}
shift-â„“val d c (Î»â„“ Ï„) = {!!}
shift-â„“val d c (Ï„ $â„“ â„“) = {!!}

data _â‰£_ {â„™ â„š} : Type â„™ â„š â†’ Type â„™ â„š â†’ Set where
  --â‰£-refl : âˆ€ {Ï„} â†’ Ï„ â‰£ Ï„
  --â‰£-sym : âˆ€ {a b} â†’ a â‰£ b â†’ b â‰£ a
  --â‰£-trans : âˆ€ {a b c} â†’ a â‰£ b â†’ b â‰£ c â†’ a â‰£ c
  â‰£-int : int â‰£ int
  â‰£-~ : âˆ€ {Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ ~ Ï„â‚ â‰£ ~ Ï„â‚‚
  â‰£-& : âˆ€ {â„“â‚ â„“â‚‚ mâ‚ mâ‚‚ Ï„â‚ Ï„â‚‚} â†’ â„“â‚ â‰¡ â„“â‚‚ â†’ mâ‚ â‰¡ mâ‚‚ â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ & â„“â‚ mâ‚ Ï„â‚ â‰£ & â„“â‚‚ mâ‚‚ Ï„â‚‚
  â‰£-opt : âˆ€ {Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ opt Ï„â‚ â‰£ opt Ï„â‚‚
  â‰£-struct : âˆ€ {n Ï„sâ‚ Ï„sâ‚‚}
           â†’ All (Î» Ï„Ï„ â†’ fst Ï„Ï„ â‰£ snd Ï„Ï„) (zip Ï„sâ‚ Ï„sâ‚‚)
           â†’ struct n Ï„sâ‚ â‰£ struct n Ï„sâ‚‚
  â‰£-tvar : âˆ€ {Tâ‚ Tâ‚‚} â†’ Tâ‚ â‰¡ Tâ‚‚ â†’ tvar Tâ‚ â‰£ tvar Tâ‚‚
  â‰£-Î¼ : âˆ€ {Tâ‚ Tâ‚‚ Ï„â‚ Ï„â‚‚} â†’ Tâ‚ â‰¡ Tâ‚‚ â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ Î¼ Tâ‚ Ï„â‚ â‰£ Î¼ Tâ‚‚ Ï„â‚‚
  â‰£-âˆ…â„“ : âˆ€ {Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ âˆ…â„“ Ï„â‚ â‰£ âˆ…â„“ Ï„â‚‚
  â‰£-Î»â„“ : âˆ€ {Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ Î»â„“ Ï„â‚ â‰£ Î»â„“ Ï„â‚‚
  â‰£-$â„“ : âˆ€ {Ï„â‚ Ï„â‚‚ â„“â‚ â„“â‚‚} â†’ Ï„â‚ â‰£ Ï„â‚‚ â†’ â„“â‚ â‰¡ â„“â‚‚ â†’ (Ï„â‚ $â„“ â„“â‚) â‰£ (Ï„â‚‚ $â„“ â„“â‚‚)
  â‰£-$Î» : âˆ€ {Ï„ â„“} â†’ (Î»â„“ Ï„ $â„“ â„“) â‰£ {!!}

{-
~-inj : âˆ€ {â„™ â„š} {a b : Type â„™ â„š} â†’ ~ a â‰¡ ~ b â†’ a â‰¡ b
~-inj refl = refl
&-inj-1 : âˆ€ {â„™ â„š mâ‚ mâ‚‚} {â„“â‚ â„“â‚‚} {a b : Type â„™ â„š} â†’ & â„“â‚ mâ‚ a â‰¡ & â„“â‚‚ mâ‚‚ b â†’ â„“â‚ â‰¡ â„“â‚‚
&-inj-1 refl = refl
&-inj-2 : âˆ€ {â„™ â„š mâ‚ mâ‚‚} {â„“â‚ â„“â‚‚} {a b : Type â„™ â„š} â†’ & â„“â‚ mâ‚ a â‰¡ & â„“â‚‚ mâ‚‚ b â†’ a â‰¡ b
&-inj-2 refl = refl
&-inj-3 : âˆ€ {â„™ â„š mâ‚ mâ‚‚} {â„“â‚ â„“â‚‚} {a b : Type â„™ â„š} â†’ & â„“â‚ mâ‚ a â‰¡ & â„“â‚‚ mâ‚‚ b â†’ mâ‚ â‰¡ mâ‚‚
&-inj-3 refl = refl
opt-inj : âˆ€ {â„™ â„š} {a b : Type â„™ â„š} â†’ opt a â‰¡ opt b â†’ a â‰¡ b
opt-inj refl = refl
struct-inj : âˆ€ {â„™ â„š n} {as bs : Vec (Type â„™ â„š) n}
           â†’ struct n as â‰¡ struct n bs
           â†’ as â‰¡ bs
struct-inj refl = refl
struct-inj-n : âˆ€ {â„™ â„š n m} {as : Vec (Type â„™ â„š) n} {bs : Vec (Type â„™ â„š) m}
             â†’ struct n as â‰¡ struct m bs
             â†’ n â‰¡ m
struct-inj-n refl = refl
tvar-inj : âˆ€ {â„™ â„š a b} â†’ tvar {â„™} {â„š} a â‰¡ tvar b â†’ a â‰¡ b
tvar-inj refl = refl
Î¼-inj : âˆ€ {â„™ â„š T} {a b : Type â„™ â„š} â†’ Î¼ T a â‰¡ Î¼ T b â†’ a â‰¡ b
Î¼-inj refl = refl
Î¼-inj-tvar : âˆ€ {â„™ â„š x y} {a b : Type â„™ â„š} â†’ Î¼ x a â‰¡ Î¼ y b â†’ x â‰¡ y
Î¼-inj-tvar refl = refl
âˆ…â„“-inj : âˆ€ {â„™ â„š a b} â†’ âˆ…â„“ {â„™} {â„š} a â‰¡ âˆ…â„“ b â†’ a â‰¡ b
âˆ…â„“-inj refl = refl
Î»â„“-inj : âˆ€ {â„™ â„š} {a b : Type â„™ (S â„š)} â†’ Î»â„“ a â‰¡ Î»â„“ b â†’ a â‰¡ b
Î»â„“-inj refl = refl
$â„“-inj : âˆ€ {â„™ â„š â„“} {a b : Type â„™ (S â„š)} â†’ a $â„“ â„“ â‰¡ b $â„“ â„“ â†’ a â‰¡ b
$â„“-inj refl = refl
$â„“-inj-arg : âˆ€ {â„™ â„š â„“â‚ â„“â‚‚} {a b : Type â„™ (S â„š)} â†’ a $â„“ â„“â‚ â‰¡ b $â„“ â„“â‚‚ â†’ â„“â‚ â‰¡ â„“â‚‚
$â„“-inj-arg refl = refl

==T : âˆ€ {â„™ â„š} â†’ (a b : Type â„™ â„š) â†’ Dec (a â‰¡ b)
==T int int = yes refl
==T int (~ b) = no (Î» ())
==T int (& x xâ‚ b) = no (Î» ())
==T int (opt b) = no (Î» ())
==T int (struct n x) = no (Î» ())
==T int (tvar x) = no (Î» ())
==T int (Î¼ x b) = no (Î» ())
==T int (âˆ…â„“ b) = no (Î» ())
==T int (Î»â„“ b) = no (Î» ())
==T int (b $â„“ x) = no (Î» ())
==T (~ a) int = no (Î» ())
==T (~ a) (~ b) with ==T a b
==T (~ a) (~ .a) | yes refl = yes refl
==T (~ a) (~ b) | no neq = no (neq âˆ˜ ~-inj)
==T (~ a) (& x xâ‚ b) = no (Î» ())
==T (~ a) (opt b) = no (Î» ())
==T (~ a) (struct n x) = no (Î» ())
==T (~ a) (tvar x) = no (Î» ())
==T (~ a) (Î¼ x b) = no (Î» ())
==T (~ a) (âˆ…â„“ b) = no (Î» ())
==T (~ a) (Î»â„“ b) = no (Î» ())
==T (~ a) (b $â„“ x) = no (Î» ())
==T (& x xâ‚ a) int = no (Î» ())
==T (& x xâ‚ a) (~ b) = no (Î» ())
==T (& â„“â‚ mâ‚ a) (& â„“â‚‚ mâ‚‚ b) with â„“â‚ == â„“â‚‚
==T (& â„“â‚ imm a) (& .â„“â‚ imm b) | yes refl with ==T a b
==T (& â„“â‚ imm a) (& .â„“â‚ imm .a) | yes refl | yes refl = yes refl
==T (& â„“â‚ imm a) (& .â„“â‚ imm b) | yes refl | no neq = no (neq âˆ˜ &-inj-2)
==T (& â„“â‚ imm a) (& .â„“â‚ mut b) | yes refl = no (Î» ())
==T (& â„“â‚ mut a) (& .â„“â‚ imm b) | yes refl = no (Î» ())
==T (& â„“â‚ mut a) (& .â„“â‚ mut b) | yes refl with ==T a b
==T (& â„“â‚ mut a) (& .â„“â‚ mut .a) | yes refl | yes refl = yes refl
==T (& â„“â‚ mut a) (& .â„“â‚ mut b) | yes refl | no neq = no (neq âˆ˜ &-inj-2)
==T (& â„“â‚ mâ‚ a) (& â„“â‚‚ mâ‚‚ b) | no â„“neq = no (â„“neq âˆ˜ &-inj-1)
==T (& x xâ‚ a) (opt b) = no (Î» ())
==T (& x xâ‚ a) (struct n xâ‚‚) = no (Î» ())
==T (& x xâ‚ a) (tvar xâ‚‚) = no (Î» ())
==T (& x xâ‚ a) (Î¼ xâ‚‚ b) = no (Î» ())
==T (& x xâ‚ a) (âˆ…â„“ b) = no (Î» ())
==T (& x xâ‚ a) (Î»â„“ b) = no (Î» ())
==T (& x xâ‚ a) (b $â„“ xâ‚‚) = no (Î» ())
==T (opt a) int = no (Î» ())
==T (opt a) (~ b) = no (Î» ())
==T (opt a) (& x xâ‚ b) = no (Î» ())
==T (opt a) (opt b) with ==T a b
==T (opt a) (opt .a) | yes refl = yes refl
==T (opt a) (opt b) | no neq = no (neq âˆ˜ opt-inj)
==T (opt a) (struct n x) = no (Î» ())
==T (opt a) (tvar x) = no (Î» ())
==T (opt a) (Î¼ x b) = no (Î» ())
==T (opt a) (âˆ…â„“ b) = no (Î» ())
==T (opt a) (Î»â„“ b) = no (Î» ())
==T (opt a) (b $â„“ x) = no (Î» ())
==T (struct n x) int = no (Î» ())
==T (struct n x) (~ b) = no (Î» ())
==T (struct n x) (& xâ‚ xâ‚‚ b) = no (Î» ())
==T (struct n x) (opt b) = no (Î» ())
==T (struct nâ‚ as) (struct nâ‚‚ bs) with nâ‚ == nâ‚‚
==T (struct nâ‚ as) (struct .nâ‚ bs) | yes refl = {!!}
==T (struct nâ‚ as) (struct nâ‚‚ bs) | no nneq = no (nneq âˆ˜ struct-inj-n)
==T (struct n x) (tvar xâ‚) = no (Î» ())
==T (struct n x) (Î¼ xâ‚ b) = no (Î» ())
==T (struct n x) (âˆ…â„“ b) = no (Î» ())
==T (struct n x) (Î»â„“ b) = no (Î» ())
==T (struct n x) (b $â„“ xâ‚) = no (Î» ())
==T (tvar x) int = no (Î» ())
==T (tvar x) (~ b) = no (Î» ())
==T (tvar x) (& xâ‚ xâ‚‚ b) = no (Î» ())
==T (tvar x) (opt b) = no (Î» ())
==T (tvar x) (struct n xâ‚) = no (Î» ())
==T (tvar a) (tvar b) with a == b
==T (tvar a) (tvar .a) | yes refl = yes refl
==T (tvar a) (tvar b) | no neq = no (neq âˆ˜ tvar-inj)
==T (tvar x) (Î¼ xâ‚ b) = no (Î» ())
==T (tvar x) (âˆ…â„“ b) = no (Î» ())
==T (tvar x) (Î»â„“ b) = no (Î» ())
==T (tvar x) (b $â„“ xâ‚) = no (Î» ())
==T (Î¼ x a) int = no (Î» ())
==T (Î¼ x a) (~ b) = no (Î» ())
==T (Î¼ x a) (& xâ‚ xâ‚‚ b) = no (Î» ())
==T (Î¼ x a) (opt b) = no (Î» ())
==T (Î¼ x a) (struct n xâ‚) = no (Î» ())
==T (Î¼ x a) (tvar xâ‚) = no (Î» ())
==T (Î¼ x a) (Î¼ y b) with x == y
==T (Î¼ x a) (Î¼ .x b) | yes refl with ==T a b
==T (Î¼ x a) (Î¼ .x .a) | yes refl | yes refl = yes refl
==T (Î¼ x a) (Î¼ .x b) | yes refl | no neq = no (neq âˆ˜ Î¼-inj)
==T (Î¼ x a) (Î¼ y b) | no neq = no (neq âˆ˜ Î¼-inj-tvar)
==T (Î¼ x a) (âˆ…â„“ b) = no (Î» ())
==T (Î¼ x a) (Î»â„“ b) = no (Î» ())
==T (Î¼ x a) (b $â„“ xâ‚) = no (Î» ())
==T (âˆ…â„“ a) int = no (Î» ())
==T (âˆ…â„“ a) (~ b) = no (Î» ())
==T (âˆ…â„“ a) (& x xâ‚ b) = no (Î» ())
==T (âˆ…â„“ a) (opt b) = no (Î» ())
==T (âˆ…â„“ a) (struct n x) = no (Î» ())
==T (âˆ…â„“ a) (tvar x) = no (Î» ())
==T (âˆ…â„“ a) (Î¼ x b) = no (Î» ())
==T (âˆ…â„“ a) (âˆ…â„“ b) with ==T a b
==T (âˆ…â„“ a) (âˆ…â„“ .a) | yes refl = yes refl
==T (âˆ…â„“ a) (âˆ…â„“ b) | no neq = no (neq âˆ˜ âˆ…â„“-inj)
==T (âˆ…â„“ a) (Î»â„“ b) = no (Î» ())
==T (âˆ…â„“ a) (b $â„“ x) = no (Î» ())
==T (Î»â„“ a) int = no (Î» ())
==T (Î»â„“ a) (~ b) = no (Î» ())
==T (Î»â„“ a) (& x xâ‚ b) = no (Î» ())
==T (Î»â„“ a) (opt b) = no (Î» ())
==T (Î»â„“ a) (struct n x) = no (Î» ())
==T (Î»â„“ a) (tvar x) = no (Î» ())
==T (Î»â„“ a) (Î¼ x b) = no (Î» ())
==T (Î»â„“ a) (âˆ…â„“ b) = no (Î» ())
==T (Î»â„“ a) (Î»â„“ b) with ==T a b
==T (Î»â„“ a) (Î»â„“ .a) | yes refl = yes refl
==T (Î»â„“ a) (Î»â„“ b) | no neq = no (neq âˆ˜ Î»â„“-inj)
==T (Î»â„“ a) (b $â„“ x) = no (Î» ())
==T (a $â„“ x) int = no (Î» ())
==T (a $â„“ x) (~ b) = no (Î» ())
==T (a $â„“ x) (& xâ‚ xâ‚‚ b) = no (Î» ())
==T (a $â„“ x) (opt b) = no (Î» ())
==T (a $â„“ x) (struct n xâ‚) = no (Î» ())
==T (a $â„“ x) (tvar xâ‚) = no (Î» ())
==T (a $â„“ x) (Î¼ xâ‚ b) = no (Î» ())
==T (a $â„“ x) (âˆ…â„“ b) = no (Î» ())
==T (a $â„“ x) (Î»â„“ b) = no (Î» ())
==T (a $â„“ x) (b $â„“ y) with x == y
==T (a $â„“ x) (b $â„“ .x) | yes refl with ==T a b
==T (a $â„“ xâ‚) (.a $â„“ .xâ‚) | yes refl | yes refl = {!!}
==T (a $â„“ xâ‚) (b $â„“ .xâ‚) | yes refl | no x = {!!}
==T (a $â„“ x) (b $â„“ y) | no neq = no (neq âˆ˜ $â„“-inj-arg)

EqType : âˆ€ {â„™ â„š} â†’ Eq (Type â„™ â„š)
EqType = record { _==_ = ==T }
-}

-- data Type : (â„“ : â„•) (Å : â„•) â†’ Set where
--   int : âˆ€ {â„“ Å} â†’ Type â„“ Å
--   ~ : âˆ€ {â„“ Å} â†’ Type â„“ Å â†’ Type â„“ Å
--   & : âˆ€ {â„“ Å} â†’ Life â„“ Å â†’ Mut â†’ Type â„“ Å â†’ Type â„“ Å
--   opt : âˆ€ {â„“ Å} â†’ Type â„“ Å â†’ Type â„“ Å
--   struct : âˆ€ {â„“ Å} n â†’ Vec (Type â„“ Å) n â†’ Type â„“ Å
--   var : âˆ€ {â„“ Å} â†’ TVar â†’ Type â„“ Å
--   Î¼ : âˆ€ {â„“ Å} â†’ TVar â†’ Type â„“ Å â†’ Type â„“ Å
--   -- we forget all existing lifetimes when we parameterize a struct
--   Î»â„“ : âˆ€ {â„“ Å} â†’ (n : â„•) â†’ Type 0 n â†’ Type â„“ Å
--   _$â„“_ : âˆ€ {â„“ Å n} â†’ Type 0 n â†’ Vec (Life 0 n) n â†’ Type â„“ Å

-- data _â‰¡â‰¡_ {â„“ Å} : Type â„“ Å â†’ Type â„“ Å â†’ Set where
--   eq-refl : âˆ€ {Ï„} â†’ Ï„ â‰¡â‰¡ Ï„
--   eq-sym : âˆ€ {a b} â†’ a â‰¡â‰¡ b â†’ b â‰¡â‰¡ a
--   eq-~ : âˆ€ {a b} â†’ a â‰¡â‰¡ b â†’ ~ a â‰¡â‰¡ ~ b
--   eq-& : âˆ€ {a b l m} â†’ a â‰¡â‰¡ b â†’ & l m a â‰¡â‰¡ & l m b
--   eq-opt : âˆ€ {a b} â†’ a â‰¡â‰¡ b â†’ opt a â‰¡â‰¡ opt b
--   eq-struct : âˆ€ {n} {as bs : Vec (Type â„“ Å) n}
--             â†’ All (Î» ab â†’ fst ab â‰¡â‰¡ snd ab) (zip as bs)
--             â†’ struct n as â‰¡â‰¡ struct n bs
--   eq-Î¼ : âˆ€ {T a b} â†’ a â‰¡â‰¡ b â†’ Î¼ T a â‰¡â‰¡ Î¼ T b
--   eq-Î»â„“ : âˆ€ {n a b} â†’ a â‰¡â‰¡ b â†’ Î»â„“ n a â‰¡â‰¡ Î»â„“ n b
--   eq-$â„“ : âˆ€ {n} {Ås : Vec (Life 0 n) n} {a b : Type 0 n} â†’ a â‰¡â‰¡ b â†’ (a $â„“ Ås) â‰¡â‰¡ (b $â„“ Ås)
--   eq-$Î» : âˆ€ {n} {Ï„ : Type 0 n} {Ås : Vec (Life 0 n) n}
--         â†’ (Î»â„“ n Ï„ $â„“ Ås) â‰¡â‰¡ {!!}

-- test-A : âˆ€ {â„“ Å} â†’ Type â„“ Å
-- test-A = struct 1 ([ int ])
-- test-B : âˆ€ {â„“ Å} â†’ Type â„“ Å
-- test-B = Î»â„“ 1 (struct 2 ([ int ,, & (var fZ) mut int ]))
-- test-C : âˆ€ {â„“ Å} â†’ Type â„“ Å
-- test-C = Î»â„“ 1 (struct 2 ([ test-A ,, test-B $â„“ ([ var fZ ]) ]))
-- test-D : âˆ€ {â„“ Å} â†’ Type â„“ Å
-- test-D = Î»â„“ 1 (struct 4 ([ test-C $â„“ ([ var fZ ]) ,, test-A
--                         ,, test-C $â„“ ([ var fZ ]) ,, test-B $â„“ ([ var fZ ]) ]))
-- test-E : âˆ€ {â„“ Å} â†’ Type â„“ Å
-- test-E = struct 1 ([ ~ int ])
-- test-List : âˆ€ {â„“ Å} â†’ Type â„“ Å
-- test-List = Î¼ (` 0) (struct 2 ([ int ,, opt (~ (var (` 0))) ]))

-- data Path : (x : â„•) â†’ Set where
--   var : âˆ€ {x} â†’ Fin x â†’ Path x
--   * : âˆ€ {x} â†’ Path x â†’ Path x
--   <_>_âˆ™_ : âˆ€ {x} â†’ (n : â„•) â†’ Path x â†’ Fin n â†’  Path x

-- data Expr : (x â„“ Å : â„•) â†’ Set where
--   num : âˆ€ {x â„“ Å} â†’ â„• â†’ Expr x â„“ Å
--   add : âˆ€ {x â„“ Å} â†’ Path x â†’ Path x â†’ Expr x â„“ Å
--   use : âˆ€ {x â„“ Å} â†’ Path x â†’ Expr x â„“ Å
--   ~ : âˆ€ {x â„“ Å} â†’ Path x â†’ Expr x â„“ Å
--   & : âˆ€ {x â„“ Å} â†’ Life â„“ Å â†’ Mut â†’ Path x â†’ Expr x â„“ Å
--   some : âˆ€ {x â„“ Å} â†’ Path x â†’ Expr x â„“ Å
--   none : âˆ€ {x â„“ Å} â†’ Type â„“ Å â†’ Expr x â„“ Å
--   struct : âˆ€ {x â„“ Å n} â†’ Vec (Path x) n â†’ Expr x â„“ Å
--   -- dealing with recursive types
--   fold : âˆ€ {x â„“ Å} â†’ Type â„“ Å â†’ Expr x â„“ Å â†’ Expr x â„“ Å
--   unfold : âˆ€ {x â„“ Å} â†’ Type â„“ Å â†’ Expr x â„“ Å â†’ Expr x â„“ Å

-- data Func : (Å x : â„•) â†’ Set

-- data Stmt : (x â„“ Å : â„•) â†’ Set where
--   seq : âˆ€ {x â„“ Å n} â†’ Vec (Stmt x â„“ Å) n â†’ Stmt x â„“ Å
--   pop : âˆ€ {x â„“ Å} â†’ Stmt (S x) â„“ Å â†’ Stmt x â„“ Å
--   -- set
--   _â†_ : âˆ€ {x â„“ Å} â†’ Path x â†’ Expr x â„“ Å â†’ Stmt x â„“ Å
--   -- overwrite
--   _:=_ : âˆ€ {x â„“ Å} â†’ Path x â†’ Expr x â„“ Å â†’ Stmt x â„“ Å
--   free : âˆ€ {x â„“ Å} â†’ Path x â†’ Stmt x â„“ Å
--   drop : âˆ€ {x â„“ Å} â†’ Path x â†’ Stmt x â„“ Å
--   block : âˆ€ {x â„“ Å n} â†’ Vec (Type (S â„“) Å) n â†’ Stmt (plus n x) (S â„“) Å â†’ Stmt x â„“ Å
--   call : âˆ€ {x â„“ Å i j} â†’ Func i j â†’ Vec (Life â„“ Å) i â†’ Vec (Path x) j â†’ Stmt x â„“ Å
--   -- TODO match

-- record FVar : Set where
--   constructor `f
--   field
--     key : â„•

-- `f-inj : âˆ€ {a b} â†’ `f a â‰¡ `f b â†’ a â‰¡ b
-- `f-inj refl = refl

-- ==FV : (a b : FVar) â†’ Dec (a â‰¡ b)
-- ==FV (`f a) (`f b) with a == b
-- ==FV (`f a) (`f .a) | yes refl = yes refl
-- ==FV (`f a) (`f b) | no neq = no (neq âˆ˜ `f-inj)

-- EqFVar : Eq FVar
-- EqFVar = record { _==_ = ==FV }

-- data Func where
--   var : âˆ€ {Å x} â†’ FVar â†’ Func Å x
--   def : âˆ€ {Å x}
--       â†’ FVar
--       â†’ Vec (Type 0 Å) x
--       â†’ Stmt x 0 Å
--       â†’ Func Å x

-- test-sum-list : Func 2 2
-- test-sum-list = def (`f 1)
--                     ([ & (var (fin 1)) imm test-List
--                     ,, & (var (fin 0)) mut int ])
--                     (block ([ int ])
--                            (seq ([ var (fin 0) â† use (< 2 > * (var (fin 2)) âˆ™ fin 0)
--                                 -- TODO match
--                                 ,, {!!} 
--                                 ])))
-- test-sum-main : Func 1 1
-- test-sum-main = def (`f 0)
--                     ([ & (var fZ) mut int ])
--                     (block ([ int
--                            ,, opt (~ test-List)
--                            ,, test-List
--                            ,, ~ test-List
--                            ])
--                            (seq ([ var (fin 3) â† num 22
--                                 ,, var (fin 2) â† none (~ test-List)
--                                 ,, var (fin 1) â† fold test-List
--                                                       (struct ([ var (fin 3)
--                                                               ,, var (fin 2) ]))
--                                 ,, var (fin 0) â† ~ (var (fin 1))
--                                 ,, var (fin 3) := num 44
--                                 ,, var (fin 2) â† some (var (fin 0))
--                                 ,, var (fin 1) â† fold test-List
--                                                       (struct ([ var (fin 3)
--                                                               ,, var (fin 2) ]))
--                                 ,, var (fin 0) â† ~ (var (fin 1))
--                                 ,, block ([ & (val (fin 0)) imm test-List ])
--                                          (seq ([ var fZ â† & (val fZ) imm (* (var (fin 1)))
--                                               ,, call test-sum-list
--                                                       ([ val (fin 0)
--                                                       ,, var (fin 0) ]) 
--                                                       ([ var fZ
--                                                       ,, var (fin 5) ])
--                                               ]))
--                                 ,, drop (var (fin 0))
--                                 ])))

-- test-Î“ : Vec (Type 1 0) 8
-- test-Î“ = [
--         {- s/0 -} opt (~ int)
--         {- r/1 -} ,, ~ int
--         {- q/2 -} ,, & (val (fin 0)) imm int
--         {- c/3 -} ,, test-C $â„“ ([ static ])
--         {- b/4 -} ,, test-B $â„“ ([ static ])
--         {- a/5 -} ,, test-A
--         {- p/6 -} ,, ~ int
--         {- i/7 -} ,, int
--         ]



-- data _âŠ¢_âˆ¶_ {X â„“ Å} (Î“ : Vec (Type â„“ Å) X) : Path X â†’ Type â„“ Å â†’ Set where
--   type-var : âˆ€ {x : Fin X} â†’ Î“ âŠ¢ var x âˆ¶ (Î“ ! x)
--   type-*~ : âˆ€ {p Ï„} â†’ Î“ âŠ¢ p âˆ¶ ~ Ï„ â†’ Î“ âŠ¢ * p âˆ¶ Ï„
--   type-*& : âˆ€ {p l m Ï„} â†’ Î“ âŠ¢ p âˆ¶ & l m Ï„ â†’ Î“ âŠ¢ * p âˆ¶ Ï„
--   type-âˆ™ : âˆ€ {n p f Ï„s} Ï„
--          â†’ Ï„ â‰¡ struct n Ï„s
--          â†’ Î“ âŠ¢ p âˆ¶ Ï„
--          â†’ Î“ âŠ¢ < n > p âˆ™ f âˆ¶ (Ï„s ! f)

-- test-lvtype-1 : test-Î“ âŠ¢ * (var (fin 6)) âˆ¶ int
-- test-lvtype-1 = type-*~ type-var
-- test-lvtype-2 : test-Î“ âŠ¢ < 2 > var (fin 3) âˆ™ fin 1 âˆ¶ (test-B $â„“ ([ static ]))
-- test-lvtype-2 = type-âˆ™ (test-C $â„“ ([ static ])) {!!} {!!}
